# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка

```
interface ICard {
    id: string;
    title: string;
    image: string;
    description: string;
    category: string;
    price: number;
}
```

Пользователь

```
interface IUser {
    payment: string;
    email: string;
    phone: string; 
    address: string;   
    total: number;
    items: string[];
}
```
Интерфейс для модели данных карточек

```
export interface ICardsData {
	cards: ICard[];
	preview: string | null;
}
```

Данные карточки, используемые в каталоге
```
type ICardPublicInfo = Pick<ICard, 'category' | 'title' | 'image' | 'price' >;
```

Данные карточки, используемые в модальном окне
```
type ICardFullInfo = Pick<ICard, 'category' | 'title' | 'image' | 'price' | 'description'>;

```
Данные карточки, используемые в корзине
```
type ICardBasketInfo = Pick<ICard,  'title' | 'price' >;
```


## Архитектура приложения
Архитектура приложения построена по модели MVP. Все ключевые взаимодействия между данными и представлением происходят в файле index.ts, который выполняет роль презентера.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` 
- `post` 
- `DELETE`

#### Класс EventEmitter
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 
- `off` - Снять обработчик с события
- `onAll` - Слушать все события
- `offAll` - Сбросить все обработчики

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек
- _preview: string | null - id карточки, выбранной для просмотра в модальной окне

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addInBasket(card: ICard): void - Делегирует добавление товара в корзину через BasketModel.add(card)
- deleteFromBasket(cardId: string, payload: Function | null = null): void - Делегирует удаление товара из корзины через BasketManager.remove(cardId). Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива.

#### Класс BasketModel
Класс отвечает за хранение товаров (карточек) в корзине. Конструктор класса принимает инстант брокера событий\

Имеет свойство, которое хранит массив из объектов и общую сумму товаров:
- items: ICard[]
- total: number

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- add(card: ICard): void - Добавляет товар в корзину, если его там ещё нет.
- remove(cardId: string): void - Удаляет товар по ID из корзины.
- clear(): void - Очищает корзину полностью.
- getItems(): ICard[] - Возвращает все текущие товары в корзине.
- getTotal(): number - функция подсчета общей суммы

#### Класс UserData
Класс отвечает за хранение данных пользователя, их валидацию,  формирование итоговой структуры заказа; очищение полей после успешной оплаты:
- data: IUser

Конструктор класса принимает инстант брокера событий\

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- setField<K extends keyof IUser>(field: K, value: IUser[K]) - Обновляет одно из полей формы. Используется при вводе пользователем данных (например, email, телефон, адрес, способ оплаты).

- setItemsAndTotal(items: string[], total: number) - Устанавливает список ID товаров и итоговую сумму заказа (получает данные из корзины при переходе к оформлению).

- isValid(): boolean - Проверяет, что контактные поля (email, phone, address) заполнены. Используется для включения/отключения кнопки «Продолжить» или «Оплатить».

- getUserData(): IUser - Возвращает полный объект с собранными пользовательскими данными. Используется при финальной отправке заказа.

- clear(): void - Очищает все поля — вызывается после успешной оплаты.

### Классы представления

#### CatalogView
Управляет отображением списка карточек товаров в каталоге. Конструктор принимает DOM-элемент каталога, в который рендерятся карточки и брокер событий.
 Основной метод:
- renderCatalog(): void — отрисовывает весь список карточек в контейнере каталога.

#### Класс CardView
Отвечает за отображение одной карточки товара на главной странице. Конструктор принимает брокер событий.
Создаёт DOM-элемент карточки, наполняет его данными и вешает обработчики событий:
- открытие модального окна при клике;
- добавление товара в корзину.

Основные методы:
- render(card: ICardPublicInfo): HTMLElement — возвращает готовую DOM-карточку;
- setEventListeners() — навешивает события (например, открытие модального окна).

#### Класс ModalView
Управляет отображением модального окна с полной информацией о товаре. Конструктор принимает брокер событий и DOM-элемент модального окна.
- отображает данные ICardFullInfo;
- закрывает модалку по клику вне окна или по кнопке "Закрыть";
- взаимодействует с корзиной (добавить / убрать товар).

Основные методы:
- open(data: ICardFullInfo): void;
- close(): void;
- setEventListeners(): void.

#### Класс BasketView
Отображает содержимое корзины и управляет его визуальной частью:
- показывает список товаров (с названием и ценой);
- удаляет товары;
- отображает итоговую сумму.

Конструктор принимает брокер событий и DOM-элемент корзины.

Основные методы:
- render(items: ICardBasketInfo[], total: number): void;
- setEventListeners() — добавляет обработчики (удалить, закрыть и оформить).

#### Класс OrderFormView
Отвечает за отображение и валидацию формы заказа (адрес, контакты ,оплата):
- отображает текущий шаг формы;
- собирает данные пользователя (email, phone, address, payment);
- валидирует поля и переключает шаги;
- вызывает сообщение об успешной оплате.

Конструктор принимает брокер событий и DOM-форму для ввода данных.

Основные методы:
- renderStep(step: number): void;
- collectData(): IUser;
- setEventListeners() — обработка ввода, переходов между шагами, отправки формы.

## Взаимодействие компонентов
Взаимодействие между компонентами реализована через брокер событий. 
*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `card:selected` — пользователь выбрал карточку (для отображения в модальном окне)
- `basket:changed` — изменилось содержимое корзины
- `user:validated` — все данные для оформления заполнены корректно
- `user:submitted` — заказ оформлен

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:clicked` — пользователь кликнул по карточке
- `card:addToBasket` — пользователь нажал "Купить" в модалке
- `card:removeFromBasket` — пользователь убрал товар из корзины
- `modal:close` — закрытие модального окна
- `basket:checkout` — переход к оформлению
- `form:update` — изменение поля в форме оформления заказа
- `form:submit` — подтверждение оформления заказа
