# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка

```
interface ICard {
    id: string;
    title: string;
    image: string;
    description: string;
    category: string;
    price: number | null;
}
```

Пользователь

```
interface IUser {
    payment: string;
    email: string;
    phone: string; 
    address: string;   
    total: number;
    items: string[];
}
```
Интерфейс для модели данных карточек

```
export interface ICardsData {
	cards: ICard[];
	preview: string | null;
}
```

Данные карточки, используемые в каталоге
```
type ICardPublicInfo = Pick<ICard, 'category' | 'title' | 'image' | 'price' >;
```

Данные карточки, используемые в модальном окне
```
type ICardFullInfo = Pick<ICard, 'category' | 'title' | 'image' | 'price' | 'description'>;

```
Данные карточки, используемые в корзине
```
type ICardBasketInfo = Pick<ICard,  'title' | 'price' >;
```


## Архитектура приложения
Архитектура приложения построена по модели MVP. Все ключевые взаимодействия между данными и представлением происходят в файле index.ts, который выполняет роль презентера.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` 
- `post` 
- `DELETE`

#### Класс EventEmitter
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 
- `off` - Снять обработчик с события
- `onAll` - Слушать все события
- `offAll` - Сбросить все обработчики

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `_cards: ICard[]` - массив объектов карточек
- `_preview: string | null` - id карточки, выбранной для просмотра в модальной окне

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `set cards(cards: ICard[])` — сеттер устанавливает массив карточек.
- `getCards(): ICard[]` — возвращает текущий массив карточек.
- `selectCard(id: string): void` — устанавливает выбранную карточку в поле `_preview` и генерирует событие `card:selected`.

#### Класс BasketModel
Класс отвечает за хранение товаров (карточек) в корзине. Конструктор класса принимает инстант брокера событий\

Имеет свойство, которое хранит массив из объектов и общую сумму товаров:
- items: ICard[]
- total: number

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addItem(item: ICardBasketInfo) - Добавляет товар в корзину, если его там ещё нет.
- removeItem(payload: { id: string })  - Удаляет товар по ID из корзины.
- clear(): void - Очищает корзину полностью.
- get items(): ICardBasketInfo[] - Возвращает все текущие товары в корзине.
- get total(): number - Возвращает общую сумму заказа.
- updateTotal() - метод обновляет сумму заказа
- emitUpdate() - через событие передает товары и сумму.

#### Класс UserData
Класс отвечает за хранение данных пользователя при оформлении заказа.
Также предоставляет методы для управления этими данными:

- setAddress(address: string) — Устанавливает адрес доставки.
- setPayment(method: string) — Устанавливает способ оплаты.
- setContacts(email: string, phone: string) — Сохраняет контактные данные, при этом удаляет пробелы из телефона.
- setBasket(total: number, items: ICardBasketInfo[]) — Устанавливает итоговую сумму и список ID товаров из корзины, исключая товары с нулевой или отсутствующей ценой.
- get totalNum — Возвращает общую сумму заказа.
- get itemsId — Возвращает список ID товаров.
- get summary — Возвращает объект с полным набором данных пользователя.
- clear() — Очищает все поля после завершения заказа.

### Классы представления

#### CatalogView
Класс отвечает за отображение каталога товаров на странице.
Предоставляет метод для обновления содержимого:

 - set catalog(items: HTMLElement[]) — Заменяет содержимое контейнера переданным списком карточек товаров. Используется при отрисовке или обновлении каталога.

#### Класс CardView
Класс отвечает за отображение карточки товара в каталоге, в превью или корзине.
Также предоставляет методы и обработчики событий для взаимодействия с карточкой:
Конструктор — Инициализирует элементы карточки и добавляет обработчики:
В режиме catalog: кнопка открытия полной карточки и кнопка добавления/удаления из корзины.
В режиме basket: кнопка удаления из корзины.
- render(cardData: Partial<ICard>, inBasket?: boolean, index?: number): HTMLElement — Отображает карточку на основе переданных данных (template). В режиме basket дополнительно выводит индекс.
- setInBasket(inBasket: boolean) — Обновляет состояние кнопки в каталоге в зависимости от того, добавлен ли товар в корзину.
- getId(): string — Возвращает ID текущей карточки.

#### Класс ModalView
Класс отвечает за отображение и управление модальным окном.
Предоставляет методы для открытия и закрытия, а также обрабатывает события взаимодействия:

Конструктор — Инициализирует элементы модального окна, добавляет обработчики закрытия по клику на крестик и вне содержимого.

- open(content?: HTMLElement): void — Очищает предыдущее содержимое, вставляет новое и открывает модальное окно. Генерирует событие modal:opened.
- close(): void — Закрывает модальное окно и генерирует событие modal:closed.

#### Класс BasketView
Класс отвечает за отображение содержимого корзины и управление кнопкой оформления заказа.
Предоставляет методы для обновления списка товаров и суммы:

Конструктор — Инициализирует элементы корзины и добавляет обработчик клика по кнопке оформления заказа, который генерирует событие basket:checkout.

- render(items: HTMLElement[], total: number) — Обновляет список товаров, отображает итоговую сумму и блокирует кнопку заказа при пустой корзине. Возвращает контейнер корзины.

Отдельный BasketPresenter не используется, поскольку логика обработки событий и связка между моделью и представлениями будет происходить в index.ts.

#### Класс OrderFormView
Класс отвечает за управление формой заказа с двумя шагами: ввод адреса и способа оплаты, затем контактных данных. Обрабатывает валидацию, обновление UI и генерацию событий.

Конструктор — Инициализирует элементы формы, навешивает обработчики для кликов и ввода, запускает начальную валидацию.
- setActiveButton(activeBtn: HTMLButtonElement) — Подсвечивает выбранную кнопку способа оплаты.
 - validateOrderStep() — Проверяет, что введён адрес и выбран способ оплаты; включает или отключает кнопку следующего шага; показывает ошибки.
- validateContactsStep() — Проверяет корректность email и телефона; включает или отключает кнопку оплаты; показывает ошибки.
- resetForm() — Сбрасывает все поля формы и стили кнопок, возвращая форму в изначальное состояние.
- render() — Возвращает корневой контейнер формы.

#### Класс SuccessView
Класс отображает сообщение об успешном завершении заказа. Он показывает сумму списанных синапсов и позволяет закрыть модальное окно с успехом.
Конструктор — Инициализирует элементы контейнера, навешивает обработчик на кнопку закрытия, который эмитит событие закрытия.
- render(total: number) — Обновляет текст описания с итоговой суммой списанных синапсов и возвращает контейнер для вставки в DOM.

## Взаимодействие компонентов
Взаимодействие между компонентами реализована через брокер событий. 
- `initialData:loaded` — загрузка карточек из API, рендер каталога товаров.
- `basket:changed` — синхронизация состояния корзины: данные пользователя и UI каталога.
- `userData:step1` — сохранение адреса и оплаты, переключение на следующий шаг ввода контактов.
-` userData:step2 `— сохранение email и телефона, отправка заказа, показ экрана успеха.
- `modalSuccess:close` — сброс всех данных и форм, закрытие модального окна успеха.
- `basket:opened` — рендер корзины и открытие модального окна с ней.
- `basket:checkout` — показ формы оформления заказа.
- `fullCard:opened` — показ детальной карточки товара в модальном окне.
- `modal:closed `— сброс форм при закрытии любого модального окна.