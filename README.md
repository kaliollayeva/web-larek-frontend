# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка

```
interface ICard {
    id: string;
    title: string;
    image: string;
    description: string;
    category: string;
    price: number | null;
}
```

Пользователь

```
interface IUser {
    payment: string;
    email: string;
    phone: string; 
    address: string;   
    total: number;
    items: string[];
}
```
Интерфейс для модели данных карточек

```
export interface ICardsData {
	cards: ICard[];
	preview: string | null;
}
```

Данные карточки, используемые в каталоге
```
type ICardPublicInfo = Pick<ICard, 'category' | 'title' | 'image' | 'price' >;
```

Данные карточки, используемые в модальном окне
```
type ICardFullInfo = Pick<ICard, 'category' | 'title' | 'image' | 'price' | 'description'>;

```
Данные карточки, используемые в корзине
```
type ICardBasketInfo = Pick<ICard,  'title' | 'price' >;
```


## Архитектура приложения
Архитектура приложения построена по модели MVP. Все ключевые взаимодействия между данными и представлением происходят в файле index.ts, который выполняет роль презентера.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` 
- `post` 
- `DELETE`

#### Класс EventEmitter
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 
- `off` - Снять обработчик с события
- `onAll` - Слушать все события
- `offAll` - Сбросить все обработчики

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `_cards: ICard[]` - массив объектов карточек
- `_preview: string | null` - id карточки, выбранной для просмотра в модальной окне

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `setCards(cards: ICard[]): void` — устанавливает массив карточек.
- `getCards(): ICard[]` — возвращает текущий массив карточек.
- `selectCard(id: string): void` — устанавливает выбранную карточку в поле `_preview` и генерирует событие `card:selected`.

#### Класс BasketModel
Класс отвечает за хранение товаров (карточек) в корзине. Конструктор класса принимает инстант брокера событий\

Имеет свойство, которое хранит массив из объектов и общую сумму товаров:
- items: ICard[]
- total: number

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- add(card: ICard): void - Добавляет товар в корзину, если его там ещё нет.
- remove(cardId: string): void - Удаляет товар по ID из корзины.
- clear(): void - Очищает корзину полностью.
- getItems(): ICard[] - Возвращает все текущие товары в корзине.
- getTotal(): number - функция подсчета общей суммы

#### Класс UserData
Класс отвечает за хранение данных пользователя, их валидацию,  формирование итоговой структуры заказа; очищение полей после успешной оплаты:
`- data: Partial<Omit<IUser, 'items' | 'total'>>`

Конструктор класса принимает инстант брокера событий\

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- setField<K extends keyof IUser>(field: K, value: IUser[K]) - Обновляет одно из полей формы. Используется при вводе пользователем данных (например, email, телефон, адрес, способ оплаты).
- setItemsAndTotal(items: string[], total: number) - Устанавливает список ID товаров и итоговую сумму заказа (получает данные из корзины при переходе к оформлению).
- isContactInfoValid(): boolean — проверяет наличие email и phone.
- isDeliveryInfoValid(): boolean — проверяет наличие адреса и способа оплаты.
- getUserData(items: string[], total: number): IUser - Возвращает полный объект с собранными пользовательскими данными
- clear(): void - Очищает все поля — вызывается после успешной оплаты.

### Классы представления

#### CatalogView
Управляет отображением списка карточек товаров в каталоге. Конструктор принимает DOM-элемент каталога, в который рендерятся карточки и брокер событий.
 Основной метод:
- renderCatalog(cardElements: HTMLElement[]): void — отрисовывает весь список карточек в контейнере каталога.

#### Класс CardView
Отвечает за отображение одной карточки товара на главной странице. Конструктор принимает брокер событий.
Создаёт DOM-элемент карточки, наполняет его данными и вешает обработчики событий:
- открытие модального окна при клике;
- добавление товара в корзину.

Основные методы:
- render(card: ICardPublicInfo): HTMLElement — возвращает готовую DOM-карточку;
- setEventListeners() — навешивает события (например, открытие модального окна).

#### Класс CardPreviewView
Отвечает за отображение карточки товара в формате модального окна.
Конструктор принимает брокер событий.

Основной метод:
- render(card: ICardFullInfo): HTMLElement
Принимает объект карточки и возвращает HTML-элемент с полной информацией о товаре и кнопкой добавления в корзину.

#### Класс ModalView
Управляет отображением модального окна с полной информацией о товаре. Конструктор принимает брокер событий и DOM-элемент модального окна.
- получает готовый HTML-элемент (содержимое модального окна) и отображает его в контейнере;
- закрывает модалку по клику вне окна или по кнопке "Закрыть";
- может быть использовано для показа карточки товара, корзины, шагов оформления заказа, экрана успешной оплаты и т.д.

Основные методы:
- open(content: HTMLElement): void — принимает DOM-элемент и вставляет его внутрь модалки;
- close(): void;
- setEventListeners(): void.

#### Класс BasketItemView
Отвечает за отображение одной карточки товара в корзине.
Создаёт HTML-элемент с отображением названия товара, цены и кнопкой удаления.
Конструктор принимает: объект карточки (ICardBasketInfo) и брокер событий

Основной метод:
render(): HTMLElement — возвращает готовый DOM-элемент карточки товара для вставки в корзину.

#### Класс BasketView
Отображает содержимое корзины и управляет его визуальной частью:
- показывает итоговую сумму заказа, 
- кнопку оформления,
- контейнер, в который вставляются карточки товаров.

Конструктор принимает брокер событий и DOM-элемент корзины.

Основные методы:
- render(items: HTMLElement[], total: number): void;
- setEventListeners() — добавляет обработчики (удалить, закрыть и оформить).

Отдельный BasketPresenter не используется, поскольку логика обработки событий и связка между моделью и представлениями будет происходить в index.ts.

#### Класс OrderFormView
Отвечает за отображение и валидацию формы заказа (адрес, контакты ,оплата):
- отображает текущий шаг формы;
- собирает данные пользователя (email, phone, address, payment);

Конструктор принимает брокер событий и DOM-форму для ввода данных.

Основные методы:
- renderStep(step: number): void;
- setEventListeners() — обработка ввода, переходов между шагами, отправки формы.

#### Класс SuccessView
Конструктор принимает контейнер, в который будет вставлено сообщение об успешной оплате.
Основной метод:
- render(total: number): void

## Взаимодействие компонентов
Взаимодействие между компонентами реализована через брокер событий. 
*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `card:selected` — пользователь выбрал карточку (для отображения в модальном окне)
- `basket:changed` — изменилось содержимое корзины
- `user:validated` — все данные для оформления заполнены корректно
- `user:submitted` — заказ оформлен, подтверждение от сервера.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:clicked` — пользователь кликнул по карточке
- `card:addToBasket` — пользователь нажал "Купить" в модалке
- `card:removeFromBasket` — пользователь убрал товар из корзины
- `modal:close` — закрытие модального окна
- `basket:checkout` — переход к оформлению
- `form:update` — изменение поля в форме оформления заказа
- `form:submit` — подтверждение оформления заказа
